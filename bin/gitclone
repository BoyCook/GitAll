#!/usr/bin/env node

'use strict';

var fs = require('fs');
var GitClone = require('../lib/gitclone');
var confFile = process.env['HOME'] + '/.gitclone/config.json';

function exit(msg) {
	console.log(msg);
	console.log('Usage: gitclone {action} {username} {dir}');
	process.exit(1);	
}

function readFile(name) {
	return JSON.parse(fs.readFileSync(name, 'utf8'));
}

function check(key, value) {
	if (typeof value === "undefined") {
		exit('You must specify [' + key +']');
	}
}

var args = process.argv.splice(2);
var action = args[0];
var username = undefined;
var dir = undefined;

if (fs.existsSync(confFile)) {
	var conf = readFile(confFile);
	username = conf.username;
	dir = conf.dir;
}

if (typeof args[1] !== "undefined") {
	username = args[1];	
}

if (typeof args[2] !== "undefined") {
	dir = args[2];
}

check('action', action);
check('username', username);
check('dir', dir);

switch (action) {
	case "clone":
		new GitClone(username, dir).clone();
		break;
	case "update":
		new GitClone(username, dir).update();
		break;	
	default:
		exit('You must use a valid action [clone|update]')
		break;			
}

